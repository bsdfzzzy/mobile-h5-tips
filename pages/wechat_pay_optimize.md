WeChat Payment H5加载优化简介
=============

## WeChat Payment模块介绍

WeChat Payment设计了以下模块：

1. 首页九宫格
2. 银行卡模块（卡列表、绑卡功能）
3. 支付模块 （拉起支付页）
4. 密码模块 （设置、验证、重设密码）
5. 交易模块 (交易历史、详情)

模块间相互调用的情况较多，各模块均依赖于requre/zepto/underscore/backbone等基础库。最初设计为各模块各自分开，模块内部使用spa方式切换页面，引用相同的基础库文件，各自实现自身功能。由于缓存，内容最大的基础库加载应该不会很慢。

## 体验优化

这种SPA与页面跳混用的方式并不成功，在页面跳转时能感觉明显的卡顿，体验并不如意。于是我们花了较大力气把各模块整合成一个SPA，加入JS预加载，切换页面卡顿的问题解决了。

有了SPA的基础，于是就有条件加入仿原生的页面切换动画了。于是在backbone router切换页面时加入了动画，并解决了判断后退的问题。

所有弹框都整改成组件，然后在组件上加入了弹框动画。

所有JS预先加载， H5内部切换页面再也不会卡顿了。

## 加载优化

因为使用了requireJS, 于是很自然地使用了r.js做为代码优化工具，合并压缩js/css。但也走了一些弯路。

考虑到手机一般有4-6个并行连接来加载网页资源，于是将CDN资源合并目标设定为4个，在chrome模拟测试中确实效果不错。但实际测试这样做反而拖慢了速度。最终合并了所有能够合并的CDN文件， 速度反而更快。 
